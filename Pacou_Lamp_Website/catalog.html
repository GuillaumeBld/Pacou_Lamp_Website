<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Catalogue - Lespwi Dacou</title>
<link rel="stylesheet" href="style.css" />
<script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
</head>
<body class="desktop-view">
<header>
<h1>Lespwi Dacou</h1>
</header>

<nav>
<ul>
<li><a href="index.html">Accueil</a></li>
<li><a href="catalog.html" class="active">Catalogue</a></li>
<li><a href="about.html">À Propos</a></li>
<li><a href="contact.html">Contactez-moi</a></li>
</ul>
</nav>

<main>
<div id="lamp-container" style="max-width: 800px; margin: 2rem auto; background: rgba(255,255,255,0.1); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border-radius: 16px; padding: 2rem; box-shadow: 0 4px 30px rgba(0,0,0,0.2); text-align: center;">
  <h2 id="lamp-title" style="margin-bottom: 1rem;">Lampe</h2>

  <div id="lamp-badge" style="margin-bottom: 0.5rem; font-weight: bold; color: #FFD700;"></div>

  <div style="display: flex; align-items: center; justify-content: center; gap: 1rem; margin-bottom: 1rem;">
    <button id="prev-img">‹</button>
    <img id="lamp-image" src="" alt="Lampe" style="max-width: 300px; border-radius: 8px;" />
    <button id="next-img">›</button>
  </div>

  <div id="lamp-price" style="font-size: 1.2rem; font-weight: bold; margin-bottom: 0.5rem;"></div>

  <div id="lamp-rating" style="margin-bottom: 1rem; font-size: 1rem; color: #FFD700;"></div>

  <div style="display: flex; justify-content: center; gap: 1rem; margin-bottom: 1rem;">
    <button style="padding: 0.75rem 1.5rem; border: none; border-radius: 8px; background: #4CAF50; color: #fff; cursor: pointer;">Acheter</button>
    <button style="padding: 0.75rem 1.5rem; border: none; border-radius: 8px; background: #ccc; color: #333; cursor: pointer;">Faire une offre</button>
  </div>

  <div id="lamp-details" style="margin-bottom: 1rem; font-size: 0.95rem; color: #eee;"></div>

  <div id="lamp-colors" style="margin-bottom: 1rem; display: flex; justify-content: center; gap: 0.5rem;"></div>

  <model-viewer id="lamp-3d" style="margin: 1rem auto; display: none; width: 100%; max-width: 400px; height: 400px; background: rgba(255,255,255,0.05); border-radius: 8px;"
    camera-controls auto-rotate ar ar-modes="webxr scene-viewer quick-look" shadow-intensity="1" exposure="1" alt="Modèle 3D de la lampe">
  </model-viewer>

  <div style="display: flex; flex-wrap: wrap; gap: 2rem; justify-content: center;">
    <p id="lamp-desc1" style="flex: 1; min-width: 200px; line-height: 1.6;"></p>
    <p id="lamp-desc2" style="flex: 1; min-width: 200px; line-height: 1.6;">Son design chaleureux s'inspire des traditions rurales, avec des finitions brutes qui révèlent la beauté naturelle du bois.</p>
  </div>
</div>

<button id="prev-lamp" style="position: fixed; top: 50%; left: 20px; transform: translateY(-50%); background: none; border: none; color: rgba(255,255,255,0.8); font-size: 1.5rem; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 0.2rem;">
  <span style="font-size: 1.5rem;">‹</span>
  <span style="font-size: 0.9rem;">Lampe précédente</span>
</button>
<button id="next-lamp" style="position: fixed; top: 50%; right: 20px; transform: translateY(-50%); background: none; border: none; color: rgba(255,255,255,0.8); font-size: 1.5rem; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 0.2rem;">
  <span style="font-size: 1.5rem;">›</span>
  <span style="font-size: 0.9rem;">Lampe suivante</span>
</button>
</main>

<footer class="site-footer">
<div class="footer-content">
<p>© 2025 Pacou-creations. Tous droits réservés</p>
</div>
</footer>

<script>
let lamps = [];
let currentLampIndex = 0;
let currentImageIndex = 0;

console.log("Fetching products.json...");
fetch('../data/products.json?v=' + Date.now())
  .then(res => res.json())
  .then(data => {
    console.log("Loaded products:", data.products.length);
    lamps = data.products;
    const params = new URLSearchParams(window.location.search);
    const lampId = parseInt(params.get('lamp'), 10);
    console.log("URL param lamp id:", lampId);
    currentLampIndex = lamps.findIndex(p => p.id === lampId);
    console.log("Current lamp index:", currentLampIndex);
    if (currentLampIndex === -1) currentLampIndex = 0;
    renderLamp();
  })
  .catch(err => console.error("Error loading products.json:", err));

function renderLamp() {
  const lamp = lamps[currentLampIndex];
  const title = document.getElementById('lamp-title');
  const image = document.getElementById('lamp-image');
  const price = document.getElementById('lamp-price');
  const desc1 = document.getElementById('lamp-desc1');
  const badge = document.getElementById('lamp-badge');
  const rating = document.getElementById('lamp-rating');
  const details = document.getElementById('lamp-details');
  const colors = document.getElementById('lamp-colors');
  const modelViewer = document.getElementById('lamp-3d');

  title.textContent = lamp.name;
  image.src = lamp.images[currentImageIndex] || 'https://via.placeholder.com/300x400?text=No+Image';

  // Price with discount
  if (lamp.originalPrice && lamp.originalPrice > lamp.price) {
    price.innerHTML = `<span style="text-decoration: line-through; color:#ccc; margin-right:8px;">${lamp.originalPrice} €</span><span>${lamp.price} €</span>`;
  } else if (lamp.price) {
    price.textContent = 'Prix: ' + lamp.price + ' €';
  } else {
    price.textContent = '';
  }

  // Badge
  badge.textContent = lamp.badge ? lamp.badge : '';

  // Rating stars
  if (lamp.rating && lamp.reviewCount) {
    const fullStars = Math.floor(lamp.rating);
    const halfStar = lamp.rating % 1 >= 0.5;
    let stars = '★'.repeat(fullStars);
    if (halfStar) stars += '½';
    stars = stars.padEnd(5, '☆');
    rating.textContent = `${stars} (${lamp.reviewCount} avis)`;
  } else {
    rating.textContent = '';
  }

  // Details list
  if (lamp.details && lamp.details.length > 0) {
    details.innerHTML = lamp.details.map(d => `• ${d}`).join('<br>');
  } else {
    details.innerHTML = '';
  }

  // Colors swatches
  if (lamp.colors && lamp.colors.length > 0) {
    colors.innerHTML = lamp.colors.map(c => 
      `<div title="${c.name}" style="width:20px; height:20px; border-radius:50%; background:${c.value}; border:1px solid #fff;"></div>`
    ).join('');
  } else {
    colors.innerHTML = '';
  }

  // 3D model viewer
  const modelPath = `assets/models/lamp${lamp.id}.glb`;
  const availableModelIds = [1,2,3,4,5,6,7,8]; // update if more models added
  if (availableModelIds.includes(lamp.id)) {
    modelViewer.src = modelPath;
    modelViewer.style.display = 'block';
  } else {
    modelViewer.style.display = 'none';
  }

  desc1.textContent = lamp.description || 'Description à venir.';
}

document.getElementById('prev-img').onclick = () => {
  const lamp = lamps[currentLampIndex];
  currentImageIndex = (currentImageIndex - 1 + lamp.images.length) % lamp.images.length;
  renderLamp();
};

document.getElementById('next-img').onclick = () => {
  const lamp = lamps[currentLampIndex];
  currentImageIndex = (currentImageIndex + 1) % lamp.images.length;
  renderLamp();
};

document.getElementById('prev-lamp').onclick = () => {
  currentLampIndex = (currentLampIndex - 1 + lamps.length) % lamps.length;
  currentImageIndex = 0;
  renderLamp();
};

document.getElementById('next-lamp').onclick = () => {
  currentLampIndex = (currentLampIndex + 1) % lamps.length;
  currentImageIndex = 0;
  renderLamp();
};
</script>
</body>
</html>
